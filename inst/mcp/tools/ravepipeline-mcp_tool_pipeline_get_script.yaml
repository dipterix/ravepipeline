# This file is automatically generated by ravepipeline::mcptool_build(). 
# Please never edit this file by hand!
name: ravepipeline-mcp_tool_pipeline_get_script
description: 'Read the main workflow document (main.Rmd) of the currently loaded pipeline.
  This document describes the pipeline workflow steps and computational targets. Only
  supports R Markdown workflows. Must call ravepipeline-mcp_tool_pipeline_load first.
  ## When to Use Need to understand pipeline workflow, computational steps, or documentation.
  When user asks "how does this pipeline work?" or needs implementation details. ##
  Preconditions - Pipeline must be loaded - Pipeline must have an R Markdown workflow
  (main.Rmd) ## Best Practices - DO: Use pattern parameter to extract specific sections
  (e.g., "^# " for headers) - DO: Use pattern to reduce output size and save tokens
  - DO: Search for specific keywords (e.g., "wavelet|frequency|baseline") - DON''T:
  Read entire main.Rmd without pattern (will be large and waste tokens) - DON''T:
  Assume you know implementation details without checking documentation'
parameters:
  type: object
  properties:
    context_size:
      type: integer
      description: 'Number of lines to include before and after each matching line
        when using pattern. Default is 5. Only used when pattern is specified. Example
        values: 3, 10, 20.'
      default: 5.0
      examples:
      - '3'
      - '10'
      - '20'
    pattern:
      type: string
      description: 'Optional regular expression pattern (R format) to search for specific
        lines in the document. If provided, only matching lines and surrounding context
        will be returned (will be using `grepl` in R). If NULL or empty (default),
        the entire document is returned. WARNING: Reading the entire document may
        result in large output. Example values: `"^# "` (section headers), `"\\{rave.*\\}"`
        (target definitions).'
category: info
returns:
  type: object
  properties:
    error:
      type: string
      description: Character, error message if success is FALSE
    warning:
      type: string
      description: Character, warning message if returning full document (which may
        be large)
    match_info:
      type: object
      description: Data frame with columns line_number and matched_text (only when
        pattern is used)
    matches:
      type: integer
      description: Integer, number of lines matching the pattern (only when pattern
        is used)
    returned_lines:
      type: integer
      description: Integer, number of lines returned (may differ from line_count when
        using pattern)
    line_count:
      type: integer
      description: Integer, total number of lines in the document
    content:
      type: array
      description: Character vector, lines of the R Markdown document (full or filtered)
      items:
        type: string
    path:
      type: string
      description: Character, absolute path to main.Rmd file
    success:
      type: boolean
      description: Logical, whether the script was read successfully
implementation_example: |
  # Complete example:
  # The tool invokes an internal call to `ravepipeline:::mcp_tool_pipeline_get_script`
  # From within R. While users should not execute the function directly,
  # this function has the following equivalent implementation:
  # Example using pipeline_name called "power_explorer"
  # Prepare: load the pipeline
  pipe <- ravepipeline::pipeline("power_explorer")
  # Example: Search for RAVE target code blocks with context
  main_path <- file.path(pipe$pipeline_path, "main.Rmd")
  all_content <- readLines(main_path, warn = FALSE)
  pattern <- "^```\\{rave"
  context_size <- 3
  # Find matching line numbers
  match_lines <- grep(pattern, all_content)
  # Expand to include context
  line_ranges <- lapply(match_lines, function(i) {
    start <- max(1, i - context_size)
    end <- min(length(all_content), i + context_size)
    start:end
  })
  unique_lines <- sort(unique(unlist(line_ranges)))
  list(
    success = TRUE,
    path = main_path,
    content = all_content[unique_lines],
    line_count = length(all_content),
    returned_lines = length(unique_lines),
    matches = length(match_lines),
    match_info = data.frame(
      line_number = match_lines,
      matched_text = all_content[match_lines]
    )
  )
  #
  #> $success
  #> [1] TRUE
  #> 
  #> $path
  #> [1] "/Users/dipterix/rave_data/cache_dir/e7b555320895b06/pipelines/power_explorer/main.Rmd"
  #> 
  #> $content
  #> [1] "options(knit_rave_pipelines = TRUE)"                                                              
  #> [2] "```"                                                                                              
  #> [3] ""                                                                                                 
  #> [4] "```{rave check_load_power, language = \"R\", export = \"repository\"}"                            
  #> [5] "subject <- ravecore::as_rave_subject(subject_id = sprintf(\"%s/%s\", project_name, subject_code))"
  #>  [ reached 'max' / getOption("max.print") -- omitted 149 entries ]
  #> 
  #> $line_count
  #> [1] 2160
  #> 
  #> $returned_lines
  #> [1] 154
  #> 
  #>  [ reached 'max' / getOption("max.print") -- omitted 2 entries ]
execution_time: 1.2
