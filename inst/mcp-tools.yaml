# MCP Tool Specifications for RAVE Pipelines
# This file provides structured metadata for AI agents to interact with RAVE pipelines
# via the Model Context Protocol (MCP). Other developers can query these specifications
# programmatically using ravepipeline::rave_mcp_tools()

version: "1.0.0"
package: "ravepipeline"
description: "Tool specifications for programmatic interaction with RAVE neuroscience analysis pipelines"

tools:
  # Discovery Tools
  - name: "ravepipeline-mcp_list_rave_pipelines"
    description: "List all installed RAVE pipelines available on the system."
    category: "discovery"
    dangerous: false
    parameters: []
    returns:
      type: "object"
      properties:
        pipelines:
          type: "array"
          description: "Array of pipeline names"
          items:
            type: "string"
        count:
          type: "integer"
          description: "Total number of available pipelines"
    example_response:
      pipelines: ["power_explorer", "notch_filter", "wavelet_module"]
      count: 3

  # Setup Tools
  - name: "ravepipeline-mcp_load_rave_pipeline"
    description: "Load a RAVE pipeline by name. This makes the pipeline available for configuration and execution. Creates a pipeline instance in the global environment as 'pipe'."
    category: "setup"
    dangerous: false
    parameters:
      - name: "pipeline_name"
        type: "string"
        required: true
        description: "Name of the pipeline to load. Use list_rave_pipelines to see available options."
        example: "power_explorer"
    returns:
      type: "object"
      properties:
        success:
          type: "boolean"
          description: "Whether the pipeline was loaded successfully"
        message:
          type: "string"
          description: "Human-readable status message"
        description:
          type: "string"
          description: "Pipeline title/description from metadata"
        targets:
          type: "integer"
          description: "Number of computational targets in the pipeline"
        error:
          type: "string"
          description: "Error message if success is false"
    example_response:
      success: true
      message: "Loaded pipeline: power_explorer"
      description: "Explore Power or Amplitude of iEEG Spectrogram"
      targets: 56

  # Information Tools
  - name: "ravepipeline-mcp_get_rave_pipeline_info"
    description: "Get detailed information about the currently loaded pipeline including targets, current settings, and available reports. Must call load_rave_pipeline first."
    category: "info"
    dangerous: false
    parameters: []
    returns:
      type: "object"
      properties:
        success:
          type: "boolean"
          description: "Whether information was retrieved successfully"
        name:
          type: "string"
          description: "Pipeline name"
        path:
          type: "string"
          description: "File system path to pipeline directory"
        description:
          type: "string"
          description: "Pipeline title/description"
        targets:
          type: "object"
          description: "Data frame of pipeline targets with Names and Description columns"
        current_settings:
          type: "object"
          description: "Current pipeline settings as key-value pairs"
        available_reports:
          type: "object"
          description: "List of available report templates with metadata"
        error:
          type: "string"
          description: "Error message if success is false"

  # Configuration Tools
  - name: "ravepipeline-mcp_set_rave_pipeline_settings"
    description: "Configure pipeline settings. This does NOT run the pipeline, only sets parameters. Settings should be provided as a JSON string. Must call load_rave_pipeline first."
    category: "configuration"
    dangerous: false
    parameters:
      - name: "settings_json"
        type: "string"
        required: true
        description: "JSON string containing pipeline settings as key-value pairs. Use get_rave_pipeline_info to see what settings are available."
        example: '{"project_name": "demo", "subject_code": "DemoSubject", "loaded_electrodes": "14-16,24"}'
    returns:
      type: "object"
      properties:
        success:
          type: "boolean"
          description: "Whether settings were applied successfully"
        message:
          type: "string"
          description: "Human-readable status message"
        current_settings:
          type: "object"
          description: "Updated pipeline settings after applying changes"
        error:
          type: "string"
          description: "Error message if success is false"

  # Execution Tools
  - name: "ravepipeline-mcp_run_rave_pipeline"
    description: "Execute the pipeline. THIS WILL RUN COMPUTATIONS - request explicit user approval before calling. Can run all targets or specific ones. Execution may take seconds to hours depending on pipeline complexity and data size."
    category: "execution"
    dangerous: true
    requires_approval: true
    parameters:
      - name: "target_names"
        type: "array"
        required: false
        description: "Optional: specific target names to run. If null or empty, runs all targets. Pipeline automatically determines dependencies, so specifying a target will also run its upstream dependencies if needed."
        items:
          type: "string"
        example: ["repository", "baselined_power", "over_time_by_condition_data"]
    returns:
      type: "object"
      properties:
        success:
          type: "boolean"
          description: "Whether pipeline execution completed successfully"
        message:
          type: "string"
          description: "Human-readable status message"
        result_summary:
          type: "object"
          description: "Data frame summarizing results with columns: name, type, data, command, depend, seed, path, time, size, bytes, format, repository, iteration, parent, children, seconds, warnings, error"
        error:
          type: "string"
          description: "Error message if success is false"
        progress:
          type: "object"
          description: "Progress information if execution failed partway through"

  # Monitoring Tools
  - name: "ravepipeline-mcp_get_rave_pipeline_progress"
    description: "Check the execution progress of the pipeline. Shows which targets are completed, running, or pending. Must call load_rave_pipeline first."
    category: "monitoring"
    dangerous: false
    parameters:
      - name: "detail_level"
        type: "string"
        required: false
        enum: ["summary", "details"]
        default: "summary"
        description: "Level of detail for progress information. 'summary' gives overview, 'details' shows per-target status."
    returns:
      type: "object"
      properties:
        success:
          type: "boolean"
          description: "Whether progress information was retrieved successfully"
        progress:
          type: "object"
          description: "Progress information in format determined by detail_level. Summary shows counts, details shows per-target status."
        error:
          type: "string"
          description: "Error message if success is false"

  # Results Tools
  - name: "ravepipeline-mcp_read_rave_pipeline_results"
    description: "Read and summarize pipeline results. Returns metadata about results rather than full data (which may be large). Use this to understand what outputs are available after pipeline execution. Must call load_rave_pipeline first and run_rave_pipeline before results are available."
    category: "results"
    dangerous: false
    parameters:
      - name: "target_names"
        type: "array"
        required: false
        description: "Optional: specific target names to read. If null or empty, reads all available results."
        items:
          type: "string"
        example: ["repository", "over_time_by_condition_data"]
    returns:
      type: "object"
      properties:
        success:
          type: "boolean"
          description: "Whether results were read successfully"
        results:
          type: "array"
          description: "Array of result summaries, each containing: name, class, type, size, and summary (structure info for data frames/arrays)"
          items:
            type: "object"
        result_names:
          type: "array"
          description: "Array of result target names"
          items:
            type: "string"
        error:
          type: "string"
          description: "Error message if success is false"

  # Visualization Tools
  - name: "ravepipeline-mcp_visualize_rave_pipeline"
    description: "Visualize the pipeline structure showing targets and their dependencies. Helps understand the computational workflow. Must call load_rave_pipeline first."
    category: "visualization"
    dangerous: false
    parameters:
      - name: "glimpse_only"
        type: "boolean"
        required: false
        default: true
        description: "If true, returns text-based glimpse suitable for console output. If false, attempts to create interactive visualization (requires graphics device)."
    returns:
      type: "object"
      properties:
        success:
          type: "boolean"
          description: "Whether visualization was generated successfully"
        message:
          type: "string"
          description: "Human-readable status message or text output if glimpse_only is true"
        target_table:
          type: "object"
          description: "Data frame of targets and dependencies if interactive visualization is not possible"
        error:
          type: "string"
          description: "Error message if success is false"

# Workflow recommendations for AI agents
workflows:
  - name: "basic_analysis"
    description: "Standard workflow for running a pipeline analysis"
    steps:
      - tool: "ravepipeline-mcp_list_rave_pipelines"
        purpose: "Discover available pipelines"
      - tool: "ravepipeline-mcp_load_rave_pipeline"
        purpose: "Load the desired pipeline"
      - tool: "ravepipeline-mcp_get_rave_pipeline_info"
        purpose: "Understand pipeline requirements and current state"
      - tool: "ravepipeline-mcp_set_rave_pipeline_settings"
        purpose: "Configure pipeline parameters"
      - tool: "ravepipeline-mcp_run_rave_pipeline"
        purpose: "Execute pipeline (requires user approval)"
        approval_required: true
      - tool: "ravepipeline-mcp_get_rave_pipeline_progress"
        purpose: "Monitor execution progress"
      - tool: "ravepipeline-mcp_read_rave_pipeline_results"
        purpose: "Retrieve and examine results"

  - name: "exploration"
    description: "Workflow for exploring pipeline structure without execution"
    steps:
      - tool: "ravepipeline-mcp_list_rave_pipelines"
      - tool: "ravepipeline-mcp_load_rave_pipeline"
      - tool: "ravepipeline-mcp_get_rave_pipeline_info"
      - tool: "ravepipeline-mcp_visualize_rave_pipeline"

  - name: "debugging"
    description: "Workflow for troubleshooting pipeline issues"
    steps:
      - tool: "ravepipeline-mcp_load_rave_pipeline"
      - tool: "ravepipeline-mcp_get_rave_pipeline_progress"
        purpose: "Check which targets succeeded/failed"
      - tool: "ravepipeline-mcp_read_rave_pipeline_results"
        purpose: "Examine partial results"

# Safety guidelines for AI agents
safety_guidelines:
  - "Always request explicit user approval before calling run_rave_pipeline"
  - "Explain what the pipeline will compute before requesting approval"
  - "Show current settings to user before execution"
  - "Monitor progress during long-running executions"
  - "Never run a pipeline without first calling get_rave_pipeline_info to understand what it does"
  - "If execution fails, use get_rave_pipeline_progress with detail_level='details' to diagnose"
  - "Be aware that pipeline execution can consume significant computational resources and time"
